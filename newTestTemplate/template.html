<head>
  <link rel="stylesheet" id="common-shared" href="common.css" />
  <!-- <link rel="stylesheet" id="template-specific" href="template.css" /> -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
  />
</head>

<!-- Include HandlebarsJS -->
<script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>

<!-- Handlebars template -->
<script id="invoice-template" type="text/x-handlebars-template">

    <div id="container" class="print-area {{#if IsCustomTemplateBackground}}template-background{{/if}}">
        <div class="temp1invoicepage">
         <!-- Top Header -->
          <div class="temp1TopHeader">
          <img src="{{companyLogoUrl.value}}" alt="Logo" />
          </div>

          <div class="temp1CardBody">
          <h2 class="temp1PageNm">#{{invoiceNr.value}}</h2>

          <!-- Header -->
          <div class="temp1Header">
              <div class="temp1HeaderLeft">

                  <i class="fa fa-bars text-danger"></i>
                  {{invoiceDate.value}}
              </p>
              <h1>
                  {{#if invoiceIsCreditNota}}
                  {{invoiceCreditNota.value}}
                  {{else}}
                  {{documentTitle}}
                  {{/if}}
              </h1>
              </div>

              <div class="temp1HeaderRight">
              {{#if hasCompanyPhoneNr}}
                  <a href="tel:{{companyPhoneNr.value}}">
                    <i class="fa-solid fa-phone"></i>
                    {{companyPhoneNr.value}}
                  </a>
              {{/if}}

              {{#if hasCompanyEmailAddress}}
                  <a href="mailto:{{companyEmailAddress.value}}">
                    <i class="fa-solid fa-envelope"></i>
                    {{companyEmailAddress.value}}
                  </a>
              {{/if}}

              {{#if hasCompanyWebUrl}}
                  <a href="{{companyWebUrl.value}}">
                    <i class="fa-solid fa-building"></i>
                    {{companyWebUrl.value}}
                  </a>
              {{/if}}

              <a>
                  {{{htmlCompanyAddress.value}}}
              </a>
              </div>
          </div>

          <!-- Invoice Details -->
          <div class="temp1InvoiceDetails">
              <div class="temp1InvoiceDetailsInner">
              <h4>{{addressedToTitle}}</h4>

              {{#if hasClientContactFullName}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{clientContactFullNameLabel.value}}</span>
                  <p>{{clientContactFullName.value}}</p>
                  </div>
              {{/if}}

              {{#if hasClientCompanyName}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{clientContactCompanyNameLabel.value}}</span>
                  <p>{{clientCompanyName.value}}</p>
                  </div>
              {{/if}}

              {{#if hasClientEmailAddress}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{clientContactEmailLabel.value}}</span>
                  <p>{{clientEmailAddress.value}}</p>
                  </div>
              {{/if}}

              {{#if htmlClientAddress.value}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{clientContactAddressLabel.value}}</span>
                  <p>{{{htmlClientAddress.value}}}</p>
                  </div>
              {{/if}}

              {{#if hasCustomFieldsAreaOnClientDetails}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{customFieldsAreaOnClientDetails.0.title.value}}</span>
                  <p>{{customFieldsAreaOnClientDetails.0.value.value}}</p>
                  </div>
              {{/if}}
              </div>

              <div class="temp1InvoiceDetailsInner temp1InvoiceDetailsInner2">
              <h4>{{paymentDetailsTitle.value}}</h4>

              <div class="temp1InvoiceDetailList">
                  <span>{{companyFinancialAccountNameLabel.value}}</span>
                  <p>{{companyFinancialAccountName.value}}</p>
              </div>
              <div class="temp1InvoiceDetailList">
                  <span>{{companyFinancialAccountHolderLabel.value}}</span>
                  <p>{{companyFinancialAccountHolder.value}}</p>
              </div>
              <div class="temp1InvoiceDetailList">
                  <span>{{companyFinancialAccountIbanLabel.value}}</span>
                  <p>{{companyFinancialAccountIban.value}}</p>
              </div>

              {{#if hasCustomFieldsAreaOnInvoiceOrQuoteDetails}}
                  <div class="temp1InvoiceDetailList">
                  <span>{{customFieldsAreaOnInvoiceOrQuoteDetails.0.title.value}}</span>
                  <p>{{customFieldsAreaOnInvoiceOrQuoteDetails.0.value.value}}</p>
                  </div>
              {{/if}}
              </div>
          </div>

          <!-- Products Table -->
          <div class="temp1InvoiceWrapper">
              <table class="temp1InvoiceTable">
              <thead class="temp1TableHead">
                  <tr>
                  <th class="temp1Th temp1AlignLeft">{{columnServiceLabel.value}}</th>
                  <th class="temp1Th">{{columnUnitsLabel.value}}</th>
                  <th class="temp1Th"></th>
                  <th class="temp1Th">{{columnAmountLabel.value}}</th>
                  <th class="temp1Th">{{columnBtwTypeLabel.value}}</th>
                  <th class="temp1Th">{{columnTotalLabel.value}}</th>
                  </tr>
              </thead>
              <tbody>
                  {{#each products}}
                  <tr>
                      <td class="temp1Td"><strong>{{title.value}}</strong></td>
                      <td class="temp1Td">{{units.value}}</td>
                      <td class="temp1Td temp1AlignLeft">{{unitType.value}}</td>
                      <td class="temp1Td">{{unitPrice.value}}</td>
                      <td class="temp1Td">{{{btwType.value}}}</td>
                      <td class="temp1Td">
                      {{totalPrice.value}}
                      <div class="temp1Discount">
                          {{#if discountType.value}}
                          <small>-{{discountType.value}}</small>
                          {{/if}}
                      </div>
                      </td>
                  </tr>

                  {{#if description.value}}
                      <tr>
                      <td colspan="6" class="temp1ItemDescription">
                          {{{description.value}}}
                      </td>
                      </tr>
                  {{/if}}

                  <tr class="temp1TdSep"></tr>
                  {{/each}}
              </tbody>

              <tfoot class="temp1Tfoot">
                  <tr>
                  <td class="temp1AlignLeft temp1Payment" colspan="3">
                      {{invoicePaymentTermsQuote.value}}
                  </td>
                  <td class="temp1TdDiscount">{{invoiceTotalAppliedDiscountLabel.value}}</td>
                  <td class="temp1InvoiceTaxDetail"><span>&nbsp;</span></td>
                  <td class="temp1TdDiscount">{{invoiceTotalAppliedDiscount.value}}</td>
                  </tr>

                  <tr>
                  <td colspan="3"></td>
                  <td class="temp1TdDiscount">{{documentSubTotalPriceLabel.value}}</td>
                  <td class="temp1InvoiceTaxDetail"><span>&nbsp;</span></td>
                  <td class="temp1TdDiscount">{{invoiceTotalPrice.value}}</td>
                  </tr>

                  {{#each taxTotals}}
                  <tr>
                      {{#if @last}}
                      <td colspan="3" class="temp1InvoiceTerms borderBottom0">
                          <div class="temp1InvoiceTermsLeft">
                          <h4>{{documentConditionsLabel.value}}</h4>
                          </div>
                      </td>
                      {{else}}
                      <td colspan="3"></td>
                      {{/if}}

                      <td class="temp1TdDiscount">{{#if @first}}{{invoiceVatSummaryLabel.value}}{{/if}}</td>
                      <td class="temp1InvoiceTaxDetail temp1AlignRight"><span>{{title.value}}</span></td>
                      <td class="temp1InvoiceTaxDetail"><p>{{total.value}}</p></td>
                  </tr>
                  {{/each}}

                  <tr>
                  <td colspan="3" class="temp1InvoiceTerms">
                      <div class="temp1InvoiceTermsLeft">
                      {{{documentConditions.value}}}
                      </div>
                  </td>
                  <td class="temp1Label temp1AlignRight">{{documentTotalPriceLabel.value}}</td>
                  <td class="temp1Td"></td>
                  <td class="temp1Value">{{invoiceTotalPriceWithVat.value}}</td>
                  </tr>
              </tfoot>
              </table>
          </div>

          <!-- Comments -->
          <div class="comments">
              {{#if hasCustomFieldsAreaBeforeComments}}
              {{{customFieldsAreaBeforeComments.value}}}
              {{/if}}
              {{{invoiceComments.value}}}
              {{{customFieldsAreaAfterComments.value}}}
          </div>
          </div>

          <!-- <div class="temp1CardFooter"> -->
            <!-- I didnt make this part of the template yet -->

      </div>
  </div>
</script>

<!-- This will be empty at first -->
<div id="template-body"></div>

<script>
  async function loadInvoice(invoiceId) {
    try {
      // Replace with however you get the token (maybe from localStorage, session, or variable)
      const token =
        "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJQcm9maWxlIjoiNjIxIiwiU3Vic2NyaWJlciI6IjQwOSIsIlVzZXJUeXBlIjoiMSIsIkNvbXBhbnlWYWx1dGFUeXBlIjoiMiIsIkxpY2Vuc2VUeXBlIjoiMzAiLCJEZXZpY2VJZCI6IldpbmRvd3MiLCJEZXZpY2VUeXBlIjoiMSIsIkxhbmd1YWdlVHlwZSI6IjEiLCJDbGllbnRJZCI6IjAiLCJVc2VyRGF0YSI6Ijg4ZTk4R0lCMDAyNXByTWhkUW00dmtNTWlJeVlSQmw0aXRGUVFvZTV5akt1bHkxOFVXcUxCaW9xS1hGMjBjSUIwMDI1dmZGWFcyWms2NngwVXIySFJMaERUTHp3UDdSMFRFTnpCSEl1OTdkdjlrNFFoNjEzU2J3MlJMaUF1SEhmdDJnT25pbk1EZXFRYXJUenNQWkRJWko3M2w2aXpuOFBZa1FNeHJJMHZmVGJld0lHMDAyNXpaYkQ2NDdMV2xiUFVmVHJJck5zUlNPTXNnWmRoMW9CQTlRZjlvaEFnQVd0ak9JQjAwMjU5d0o3a1ZlSUIwMDI1VnRlYTd4MDIzVTc0RUxlOGtuUUtRYUlHMDAyNUU5d056QUg2akk3SVpYZmc0QmxCMXRya3FDT2FpQlltTnFJTUlRdFZJM0o0WGpRaFpoajdtY0tJbkg1VnUwQ3M3d3hVQnVrVDFpTXV3NlJMOG1GYzBnM3BGQ0x4QjB6amU0a0xTbFM4RndDZXFJQjAwMjVFWTd1bHg3emcxc0JBZ2JPTW9sVklYc2hISGtlQUE2cjBpTzcwRkRDa2lJSEFiQTNreEZZS09lOFhUSUIwMDI1TG1ERXNJRzAwMjU3bFg4Q25MandFdWdNVGVoMlNQeVZJRzAwMjVvZDVVWlYwbzA0OElJeGF3VTZIdnRvbEgweEF0NURGSkNIYlNkcFFBenRXVnYwcFFjd2RRRUVvVnNxNXc5R0RRbGZFUFZ4QzFGa3pUUkx0ekZDZU9IYUNzMUFvblpQc0hqZkJ3ZGE0SWFlaXE1bTFEY1pJSUIwMDI1QzBsZDB5bHByblVvdnRVVUZsVVhmSDcxSjd0WjF4RnNvNHVoSm5UNEV0WVAzamRoM004ZU1OVUlHMDAyNVlJYWxhMzdNeGJyOTZoRWIzMTJMRmZLakxnMWZ0RUlrODlDWkNpTFU0STRsbFAwSllWa0dJY2k0b1hXdkI2YjZUU2E3T2ZNUjljaVlIMXc3d3dzdHVKclIyUkpzR2xWSUcwMDI1d0MwQVZqMEM3bHV2bGpJQjAwMjVDSzVkZnpJQjAwMjVRQ2duUkFtcUpWR0xnRElmQmFtRXFlV2RtSWVnSUUwMDI1SUUwMDI1Iiwicm9sZSI6WyJpbnZvaWNlaGlwcG8ubW9kdWxlLmRhc2hib2FyZCIsImludm9pY2VoaXBwby5tb2R1bGUuY2xpZW50cyIsImludm9pY2VoaXBwby5tb2R1bGUuaW52b2ljZXMiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLmRpc2NvdW50bWFyZ2lucyIsImludm9pY2VoaXBwby5tb2R1bGUucmVtaW5kZXJub3RpZmljYXRpb25zZXR0aW5ncyIsImludm9pY2VoaXBwby5tb2R1bGUucXVvdGVzIiwiaW52b2ljZWhpcHBvLm1vZHVsZS5wcm9kdWN0cyIsImludm9pY2VoaXBwby5tb2R1bGUuY29zdCIsImludm9pY2VoaXBwby5tb2R1bGUuYXR0YWNobWVudHNpbmJveCIsImludm9pY2VoaXBwby5tb2R1bGUuc2V0dGluZ3MiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLnVwZ3JhZGUiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLmludm9pY2VwYXltZW50cyIsImludm9pY2VoaXBwby5tb2R1bGUuY29tcGFueW1hbmFnZW1lbnQiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLnVwZ3JhZGUiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLnZhdHJlcG9ydGluZyIsImludm9pY2VoaXBwby5tb2R1bGUucmVwb3J0aW5nIiwiaW52b2ljZWhpcHBvLm1vZHVsZS5jdXN0b21maWVsZHMiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLm9jcnNjYW5uaW5nIiwiaW52b2ljZWhpcHBvLm1vZHVsZS5pbnZvaWNlc3Vic2NyaXB0aW9ucyIsImludm9pY2VoaXBwby5tb2R1bGUuYmFua211dGF0aW9ucyIsImludm9pY2VoaXBwby5tb2R1bGUuYWNjb3VudGluZyIsImludm9pY2VoaXBwby5tb2R1bGUuYWNjb3VudGluZ2Ftb3J0aXNhdGlvbnMiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLnBsdWdpbnMiLCJpbnZvaWNlaGlwcG8ubW9kdWxlLm1pbGVhZ2V0cmFja2luZyIsImludm9pY2VoaXBwby5tb2R1bGUuaG91cnN0cmFja2luZyIsImludm9pY2VoaXBwby5tb2R1bGUucXVvdGVzdmFsaWRhdGlvbiJdLCJuYmYiOjE3NTU2MTczODYsImV4cCI6MTc1NTY0NjE4NiwiaWF0IjoxNzU1NjE3Mzg2LCJpc3MiOiJodHRwczovL21pam4uaW52b2ljZWhpcHBvLm5sIiwiYXVkIjoiaHR0cHM6Ly93d3cuaW52b2ljZWhpcHBvLm5sIn0.Ymr69f9qkzi7-TeI0iB6U2Hk94IcFI8vKpDxDuVLUG4";
      // 1. Fetch JSON data with Bearer token
      const response = await fetch(
        `https://api-tst.invoicehippo.nl/api/v1/invoice/${invoiceId}/template/view-data`,
        {
          method: "GET",
          headers: {
            Authorization: token,
            "Content-Type": "application/json",
          },
        }
      );

      if (!response.ok) {
        throw new Error("Failed to fetch invoice data: " + response.status);
      }

      const data = await response.json();
      console.log(data);
      // 2. Get template source
      const source = document.getElementById("invoice-template").innerHTML;

      // 3. Compile with Handlebars
      const template = Handlebars.compile(source);

      // 4. Fill with API data
      const filledHtml = template(data.result);

      // 5. Insert into DOM
      document.getElementById("template-body").innerHTML = filledHtml;
    } catch (err) {
      console.error(err);
      document.getElementById("template-body").innerHTML =
        "<p>Error loading invoice</p>";
    }
  }

  // Example usage
  loadInvoice(20351);
</script>
